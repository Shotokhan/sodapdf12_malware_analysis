import json
import csv


if __name__ == "__main__":
    with open("mitre.json", "r") as f:
        mitre = json.load(f)
    techniques = mitre['techniques']
    tactics = ['initial-access', 'execution', 'persistence',
               'privilege-escalation', 'defense-evasion',
               'credential-access', 'discovery', 'lateral-movement',
               'collection', 'command-and-control', 'exfiltration',
               'impact']
    techs = {}
    rows = []
    for t in techniques:
        if t["showSubtechniques"]:
            continue
        tid = t["techniqueID"]
        if tid not in techs:
            techs[tid] = []
        techs[tid].append(t['tactic'])
    for tech in sorted(techs.keys()):
        row = {tactic: "" if tactic not in techs[tech] else tech
               for tactic in tactics}
        rows.append(row)
        
    with open('mitre.csv', 'w') as f:
        writer = csv.DictWriter(f, fieldnames=tactics)
        writer.writeheader()
        for row in rows:
            writer.writerow(row)

